<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Donor Dashboard - CareBloom</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
  </head>
  <body class="bg-gradient-to-r from-pink-100 via-rose-100 to-orange-100 min-h-screen">
    <div class="flex min-h-screen">
   <!-- Sidebar -->
<aside class="w-64 flex-shrink-0 bg-amber-50 shadow-lg flex flex-col">
    <div class="p-6 text-2xl font-bold text-center border-b">üå±Care<span class="text-pink-600">Bloom</span></div>
    <nav class="flex-grow p-4 space-y-2">
        <a href="#" id="nav-dashboard" class="nav-link flex items-center px-4 py-3 font-semibold text-white bg-pink-500 rounded-lg">
            <i class="fas fa-tachometer-alt w-6 text-center mr-3"></i>Dashboard
        </a>
        <a href="#" id="nav-donations" class="nav-link flex items-center px-4 py-3 text-gray-600 hover:bg-pink-100 rounded-lg">
            <i class="fas fa-gift w-6 text-center mr-3"></i>My Donations
        </a>
        <a href="#" id="nav-requests" class="nav-link flex items-center px-4 py-3 text-gray-600 hover:bg-pink-100 rounded-lg">
            <i class="fas fa-handshake w-6 text-center mr-3"></i>Donation Requests
        </a>
        <a href="#" id="nav-tracking" class="nav-link flex items-center px-4 py-3 text-gray-600 hover:bg-pink-100 rounded-lg">
            <i class="fas fa-shipping-fast w-6 text-center mr-3"></i>Delivery Tracking
        </a>
        <a href="#" id="nav-profile" class="nav-link flex items-center px-4 py-3 text-gray-600 hover:bg-pink-100 rounded-lg">
            <i class="fas fa-user w-6 text-center mr-3"></i>Profile
        </a>
        
        <!-- üîî NOTIFICATIONS BELL -->
        <!-- <div class="relative">
            <button id="notifications-btn" class="nav-link flex items-center px-4 py-3 text-gray-600 hover:bg-pink-100 rounded-lg w-full text-left">
                <i class="fas fa-bell w-6 text-center mr-3"></i>
                Notifications
                <span id="notification-count" class="ml-auto bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center hidden">0</span>
            </button>
        </div> -->
        <!-- üîî END NOTIFICATIONS -->
        
    </nav>
    <div class="p-4 border-t">
        <a href="#" id="nav-logout" class="flex items-center px-4 py-3 text-gray-600 hover:bg-pink-100 rounded-lg">
            <i class="fas fa-sign-out-alt w-6 text-center mr-3"></i>Logout
        </a>
    </div>
</aside>

<!-- üîî NOTIFICATIONS DROPDOWN -->
<div id="notifications-dropdown" class="hidden fixed right-4 top-20 w-80 bg-white rounded-lg shadow-xl z-50 max-h-96 overflow-y-auto border border-gray-200">
    <div class="p-4 border-b bg-pink-50">
        <h3 class="font-semibold text-gray-800">Notifications</h3>
        <p class="text-sm text-gray-500">Latest updates</p>
    </div>
    <div id="notifications-list" class="p-2">
        <p class="text-gray-500 text-center p-4">No new notifications</p>
    </div>
    <div class="p-2 border-t bg-gray-50">
        <button id="mark-all-read" class="w-full text-pink-600 hover:text-pink-700 text-sm py-2 font-medium">
            Mark all as read
        </button>
    </div>
</div>

      <!-- Main Content -->
      <main class="flex-1 p-6">
        <!-- Dashboard View -->
        <div id="view-dashboard">
          <div class="bg-amber-50 rounded-2xl shadow-xl w-full p-6 mb-6">
            <h1 class="font-bold text-black text-3xl">Welcome, <span id="user-name">User</span>! üå∑</h1>
            <p class="mt-1.5 text-xl font-normal text-black">
              Your Garden is Flourishing! You have helped <span id="ngo-count">0</span> NGOs and Touched <span id="lives-touched">0</span> Lives! üéóÔ∏è
            </p>
          </div>

          <!-- Stats Cards -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
            <div class="bg-white rounded-xl shadow-lg p-6 text-center">
              <div class="text-3xl font-bold text-pink-600 mb-2" id="total-donations">0</div>
              <div class="text-gray-600">Total Donations</div>
            </div>
            <div class="bg-white rounded-xl shadow-lg p-6 text-center">
              <div class="text-3xl font-bold text-green-600 mb-2" id="pending-requests">0</div>
              <div class="text-gray-600">Pending Requests</div>
            </div>
            <div class="bg-white rounded-xl shadow-lg p-6 text-center">
              <div class="text-3xl font-bold text-blue-600 mb-2" id="active-deliveries">0</div>
              <div class="text-gray-600">Active Deliveries</div>
            </div>
          </div>

          <!-- Donation Form -->
          <section class="donation-form bg-amber-50 rounded-2xl shadow-xl p-8">
            <h2 class="text-2xl text-black font-bold mb-6">Plant a New Seed (Make a new donation) üå±</h2>
            <form id="donation-form" class="space-y-6">
              <div>
                <label for="item-name" class="block text-xl text-black font-medium mb-2">Item Name</label>
                <input id="item-name" type="text" required class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-pink-400" placeholder="e.g., Winter Jacket">
              </div>

              <div>
                <label for="quantity-required" class="block text-xl text-black font-medium mb-2">Quantity</label>
                <input id="quantity-required" type="text" required class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-pink-400" placeholder="e.g., 5 jackets">
              </div>

              <!-- Image Upload Section -->
              <div>
                <label for="item-images" class="block text-xl text-black font-medium mb-2">Add Photos</label>
                <div class="image-upload-area relative flex flex-col justify-center items-center p-8 border-2 border-dashed border-pink-500 rounded-lg cursor-pointer bg-pink-50 hover:bg-pink-100 transition-colors duration-200 min-h-[200px]">
                  <input type="file" id="item-images" accept="image/*" multiple class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">
                  <div class="text-center">
                    <i class="fa-solid fa-camera text-4xl text-pink-600 mb-2"></i>
                    <p class="text-gray-700">Drag & Drop or click to browse</p>
                    <p class="text-sm text-gray-500 mt-1">Max file size: 5MB</p>
                  </div>
                  <div id="image-preview-container" class="flex flex-wrap gap-4 mt-4 justify-center"></div>
                </div>
              </div>

              <div>
                <label for="item-description" class="block text-xl text-black font-medium mb-2">Item Description</label>
                <textarea id="item-description" rows="4" required class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-pink-400" placeholder="Describe the item's condition, size, etc."></textarea>
              </div>

              <!-- <div>
                <label class="block text-xl text-black font-medium mb-2">Select Tag</label>
                <div class="flex flex-wrap gap-2" id="tag-buttons">
                  <button type="button" class="tag-btn bg-white text-pink-600 font-medium rounded-2xl px-4 py-2 hover:bg-pink-500 hover:text-black transition-colors">Books</button>
                  <button type="button" class="tag-btn bg-white text-pink-600 font-medium rounded-2xl px-4 py-2 hover:bg-pink-500 hover:text-white transition-colors">Clothes</button>
                  <button type="button" class="tag-btn bg-white text-pink-600 font-medium rounded-2xl px-4 py-2 hover:bg-pink-500 hover:text-white transition-colors">Toys</button>
                  <button type="button" class="tag-btn bg-white text-pink-600 font-medium rounded-2xl px-4 py-2 hover:bg-pink-500 hover:text-white transition-colors">Utensils</button>
                  <button type="button" class="tag-btn bg-white text-pink-600 font-medium rounded-2xl px-4 py-2 hover:bg-pink-500 hover:text-white transition-colors">Electronics</button>
                  <button type="button" class="tag-btn bg-white text-pink-600 font-medium rounded-2xl px-4 py-2 hover:bg-pink-500 hover:text-white transition-colors">Small furniture</button>
                  <button type="button" class="tag-btn bg-white text-pink-600 font-medium rounded-2xl px-4 py-2 hover:bg-pink-500 hover:text-white transition-colors">Sports Equipment</button>
                  <button type="button" class="tag-btn bg-white text-pink-600 font-medium rounded-2xl px-4 py-2 hover:bg-pink-500 hover:text-white transition-colors">Bedding & Blankets</button>
                  <button type="button" class="tag-btn bg-white text-pink-600 font-medium rounded-2xl px-4 py-2 hover:bg-pink-500 hover:text-white transition-colors">Towels</button>
                  <button type="button" class="tag-btn bg-white text-pink-600 font-medium rounded-2xl px-4 py-2 hover:bg-pink-500 hover:text-white transition-colors">Baby Gear</button>
                  <button type="button" class="tag-btn bg-white text-pink-600 font-medium rounded-2xl px-4 py-2 hover:bg-pink-500 hover:text-white transition-colors">Feminine Hygiene</button>
                  <button type="button" class="tag-btn bg-white text-pink-600 font-medium rounded-2xl px-4 py-2 hover:bg-pink-500 hover:text-white transition-colors">First-Aid Supplies</button>
                  <button type="button" class="tag-btn bg-white text-pink-600 font-medium rounded-2xl px-4 py-2 hover:bg-pink-500 hover:text-white transition-colors">Medical Aids</button>
                  <button type="button" class="tag-btn bg-white text-pink-600 font-medium rounded-2xl px-4 py-2 hover:bg-pink-500 hover:text-white transition-colors">Tools & Hardware</button>
                  <button type="button" class="tag-btn bg-white text-pink-600 font-medium rounded-2xl px-4 py-2 hover:bg-pink-500 hover:text-white transition-colors">Pet Supplies</button>
                  <button type="button" class="tag-btn bg-white text-pink-600 font-medium rounded-2xl px-4 py-2 hover:bg-pink-500 hover:text-white transition-colors">Cleaning Supplies</button>
                  <button type="button" class="tag-btn bg-white text-pink-600 font-medium rounded-2xl px-4 py-2 hover:bg-pink-500 hover:text-white transition-colors">Home Appliances</button>
                  <button type="button" class="tag-btn bg-white text-pink-600 font-medium rounded-2xl px-4 py-2 hover:bg-pink-500 hover:text-white transition-colors">Others</button>
                </div>
                <input type="" id="selected-tag">
              </div> -->

               <div>
                <label class="block text-xl text-black font-medium mb-2"
                  >Select Tag</label
                >
                <div class="flex flex-wrap gap-2" id="tag-buttons">
                  <button
                    type="button"
                    class="tag-btn bg-white text-pink-600 font-medium rounded-2xl px-4 py-2 hover:bg-pink-500 hover:text-white transition-colors"
                  >
                    Books
                  </button>
                  <button
                    type="button"
                    class="tag-btn bg-white text-pink-600 font-medium rounded-2xl px-4 py-2 hover:bg-pink-500 hover:text-white transition-colors"
                  >
                    Clothes
                  </button>
                  <button
                    type="button"
                    class="tag-btn bg-white text-pink-600 font-medium rounded-2xl px-4 py-2 hover:bg-pink-500 hover:text-white transition-colors"
                  >
                    Toys
                  </button>
                  <button
                    type="button"
                    class="tag-btn bg-white text-pink-600 font-medium rounded-2xl px-4 py-2 hover:bg-pink-500 hover:text-white transition-colors"
                  >
                    Utensils
                  </button>
                  <button
                    type="button"
                    class="tag-btn bg-white text-pink-600 font-medium rounded-2xl px-4 py-2 hover:bg-pink-500 hover:text-white transition-colors"
                  >
                    Electronics
                  </button>
                  <button
                    type="button"
                    class="tag-btn bg-white text-pink-600 font-medium rounded-2xl px-4 py-2 hover:bg-pink-500 hover:text-white transition-colors"
                  >
                    Small furniture
                  </button>
                  <button
                    type="button"
                    class="tag-btn bg-white text-pink-600 font-medium rounded-2xl px-4 py-2 hover:bg-pink-500 hover:text-white transition-colors"
                  >
                    Sports Equipment
                  </button>
                  <button
                    type="button"
                    class="tag-btn bg-white text-pink-600 font-medium rounded-2xl px-4 py-2 hover:bg-pink-500 hover:text-white transition-colors"
                  >
                    Bedding & Blankets
                  </button>
                  <button
                    type="button"
                    class="tag-btn bg-white text-pink-600 font-medium rounded-2xl px-4 py-2 hover:bg-pink-500 hover:text-white transition-colors"
                  >
                    Towels
                  </button>
                  <button
                    type="button"
                    class="tag-btn bg-white text-pink-600 font-medium rounded-2xl px-4 py-2 hover:bg-pink-500 hover:text-white transition-colors"
                  >
                    Baby Gear (strollers, car seats)
                  </button>
                  <button
                    type="button"
                    class="tag-btn bg-white text-pink-600 font-medium rounded-2xl px-4 py-2 hover:bg-pink-500 hover:text-white transition-colors"
                  >
                    Feminine Hygiene Products
                  </button>
                  <button
                    type="button"
                    class="tag-btn bg-white text-pink-600 font-medium rounded-2xl px-4 py-2 hover:bg-pink-500 hover:text-white transition-colors"
                  >
                    First-Aid Supplies
                  </button>
                  <button
                    type="button"
                    class="tag-btn bg-white text-pink-600 font-medium rounded-2xl px-4 py-2 hover:bg-pink-500 hover:text-white transition-colors"
                  >
                    Medical Aids (Wheelchairs, Crutches)
                  </button>
                  <button
                    type="button"
                    class="tag-btn bg-white text-pink-600 font-medium rounded-2xl px-4 py-2 hover:bg-pink-500 hover:text-white transition-colors"
                  >
                    Tools & Hardware
                  </button>
                  <button
                    type="button"
                    class="tag-btn bg-white text-pink-600 font-medium rounded-2xl px-4 py-2 hover:bg-pink-500 hover:text-white transition-colors"
                  >
                    Pet Supplies
                  </button>
                  <button
                    type="button"
                    class="tag-btn bg-white text-pink-600 font-medium rounded-2xl px-4 py-2 hover:bg-pink-500 hover:text-white transition-colors"
                  >
                    Cleaning Supplies
                  </button>
                  <button
                    type="button"
                    class="tag-btn bg-white text-pink-600 font-medium rounded-2xl px-4 py-2 hover:bg-pink-500 hover:text-white transition-colors"
                  >
                    Home Appliances (Small)
                  </button>
                  <button
                    type="button"
                    class="tag-btn bg-white text-pink-600 font-medium rounded-2xl px-4 py-2 hover:bg-pink-500 hover:text-white transition-colors"
                  >
                    Others
                  </button>
                </div>
                <input type="hidden" id="selected-tag" />
              </div>

              <button id="donate-item-btn" type="button" class="w-full bg-pink-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-pink-700 transition-colors">
                Donate Item
              </button>
            </form>
          </section>
        </div>

        <!-- My Donations View -->
        <div id="view-donations" class="hidden">
          <div class="bg-amber-50 rounded-2xl shadow-xl w-full p-8">
            <h1 class="font-bold text-black text-3xl mb-6">My Donations üéÅ</h1>
            <div id="donations-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              <p id="no-donations-message" class="col-span-full text-center text-gray-500">You haven't made any donations yet.</p>
            </div>
          </div>
        </div>

        <!-- Donation Requests View -->
        <div id="view-requests" class="hidden">
          <div class="bg-amber-50 rounded-2xl shadow-xl w-full p-8">
            <h1 class="font-bold text-black text-3xl mb-6">Donation Requests ü§ù</h1>
            <div id="requests-container" class="space-y-6">
              <p id="no-requests-message" class="text-center text-gray-500">No pending requests at the moment.</p>
            </div>
          </div>
        </div>

        <!-- Delivery Tracking View -->
        <div id="view-tracking" class="hidden">
          <div class="bg-amber-50 rounded-2xl shadow-xl w-full p-8">
            <h1 class="font-bold text-black text-3xl mb-6">Delivery Tracking üöö</h1>
            <div id="tracking-container" class="space-y-6">
              <p id="no-tracking-message" class="text-center text-gray-500">No active deliveries to track.</p>
            </div>
          </div>
        </div>

        <!-- Profile View -->
        <div id="view-profile" class="hidden">
          <div class="bg-amber-50 rounded-2xl shadow-xl w-full p-8">
            <h1 class="font-bold text-black text-3xl mb-6">My Profile üë§</h1>
            <form id="profile-form" class="space-y-6">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                  <label for="profile-first-name" class="block text-xl text-black font-medium mb-2">First Name</label>
                  <input id="profile-first-name" type="text" required class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-pink-400">
                </div>
                <div>
                  <label for="profile-last-name" class="block text-xl text-black font-medium mb-2">Last Name</label>
                  <input id="profile-last-name" type="text" required class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-pink-400">
                </div>
              </div>
              <div>
                <label for="profile-email" class="block text-xl text-black font-medium mb-2">Email</label>
                <input id="profile-email" type="email" disabled class="w-full px-4 py-2 rounded-lg border border-gray-300 bg-gray-100 cursor-not-allowed">
              </div>
              <div>
                <label for="profile-phone-number" class="block text-xl text-black font-medium mb-2">Phone Number</label>
                <input id="profile-phone-number" type="tel" required class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-pink-400">
              </div>
              <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div>
                  <label for="profile-age" class="block text-xl text-black font-medium mb-2">Age</label>
                  <input id="profile-age" type="number" required class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-pink-400">
                </div>
                <div>
                  <label for="profile-city" class="block text-xl text-black font-medium mb-2">City</label>
                  <input id="profile-city" type="text" required class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-pink-400">
                </div>
                <div>
                  <label for="profile-state" class="block text-xl text-black font-medium mb-2">State</label>
                  <select id="profile-state" required class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-pink-400 bg-white">
                    <option value="">Select State</option>
                    <option value="Andhra Pradesh">Andhra Pradesh</option>
                    <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                    <option value="Assam">Assam</option>
                    <option value="Bihar">Bihar</option>
                    <option value="Chhattisgarh">Chhattisgarh</option>
                    <option value="Goa">Goa</option>
                    <option value="Gujarat">Gujarat</option>
                    <option value="Haryana">Haryana</option>
                    <option value="Himachal Pradesh">Himachal Pradesh</option>
                    <option value="Jharkhand">Jharkhand</option>
                    <option value="Karnataka">Karnataka</option>
                    <option value="Kerala">Kerala</option>
                    <option value="Madhya Pradesh">Madhya Pradesh</option>
                    <option value="Maharashtra">Maharashtra</option>
                    <option value="Manipur">Manipur</option>
                    <option value="Meghalaya">Meghalaya</option>
                    <option value="Mizoram">Mizoram</option>
                    <option value="Nagaland">Nagaland</option>
                    <option value="Odisha">Odisha</option>
                    <option value="Punjab">Punjab</option>
                    <option value="Rajasthan">Rajasthan</option>
                    <option value="Sikkim">Sikkim</option>
                    <option value="Tamil Nadu">Tamil Nadu</option>
                    <option value="Telangana">Telangana</option>
                    <option value="Tripura">Tripura</option>
                    <option value="Uttar Pradesh">Uttar Pradesh</option>
                    <option value="Uttarakhand">Uttarakhand</option>
                    <option value="West Bengal">West Bengal</option>
                    <option value="Andaman and Nicobar Islands">Andaman and Nicobar Islands</option>
                    <option value="Chandigarh">Chandigarh</option>
                    <option value="Dadra and Nagar Haveli and Daman and Diu">Dadra and Nagar Haveli and Daman and Diu</option>
                    <option value="Delhi">Delhi</option>
                    <option value="Lakshadweep">Lakshadweep</option>
                    <option value="Puducherry">Puducherry</option>
                    <option value="Ladakh">Ladakh</option>
                    <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                  </select>
                </div>
              </div>
              <div>
                <label for="profile-pin-code" class="block text-xl text-black font-medium mb-2">Pincode</label>
                <input id="profile-pin-code" type="text" required class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-pink-400">
              </div>
              <div>
                <label for="profile-address" class="block text-xl text-black font-medium mb-2">Address</label>
                <textarea id="profile-address" rows="3" required class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-pink-400"></textarea>
              </div>
              <button id="update-profile-btn" type="submit" class="w-full bg-pink-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-pink-700 transition-colors">
                Update Profile
              </button>
            </form>
          </div>
        </div>
      </main>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmation-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
      <div class="bg-white rounded-2xl shadow-xl w-full max-w-sm p-6 text-center">
        <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-pink-100 mb-4">
          <i class="fas fa-hand-holding-heart text-pink-600 text-2xl"></i>
        </div>
        <h3 class="text-lg font-medium text-gray-900">Confirm Donation</h3>
        <p class="mt-2 text-sm text-gray-500">Are you sure you want to list this item for donation?</p>
        <div class="mt-6 flex justify-center gap-4">
          <button id="confirm-donate-btn" type="button" class="bg-pink-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-pink-700 transition-colors">Yes, Donate</button>
          <button id="cancel-donate-btn" type="button" class="bg-gray-200 text-gray-800 font-bold py-2 px-6 rounded-lg hover:bg-gray-300 transition-colors">No, Cancel</button>
        </div>
      </div>
    </div>

    <!-- Success Modal -->
    <div id="success-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
      <div class="bg-white rounded-2xl shadow-xl w-full max-w-sm p-6 text-center">
        <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100 mb-4">
          <i class="fas fa-check text-green-600 text-2xl"></i>
        </div>
        <h3 class="text-lg font-medium text-gray-900">Success!</h3>
        <p class="mt-2 text-sm text-gray-500">Item donated successfully! Check your donations in the 'My Donations' tab.</p>
        <div class="mt-6">
          <button id="success-ok-btn" type="button" class="w-full bg-pink-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-pink-700 transition-colors">Okay</button>
        </div>
      </div>
    </div>

    <!-- Request Decision Modal -->
    <div id="request-decision-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
      <div class="bg-white rounded-2xl shadow-xl w-full max-w-md p-6">
        <h3 class="text-lg font-medium text-gray-900 mb-4" id="request-modal-title">Donation Request</h3>
        <div id="request-modal-content">
          <!-- Content will be filled dynamically -->
        </div>
        <div class="mt-6 flex justify-center gap-4">
          <button id="accept-request-btn" class="bg-green-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-green-700 transition-colors">Accept</button>
          <button id="reject-request-btn" class="bg-red-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-red-700 transition-colors">Reject</button>
          <button id="cancel-request-btn" class="bg-gray-200 text-gray-800 font-bold py-2 px-6 rounded-lg hover:bg-gray-300 transition-colors">Cancel</button>
        </div>
      </div>
    </div>

   <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
   <script src="./auth.js"></script>
<script>
document.addEventListener("DOMContentLoaded", async () => {
    // === AUTH CHECK - AT THE VERY START ===
    console.log('üîê Checking Donor Dashboard authentication...');
    
    // Check authentication first using auth.js
    const session = await window.authHelper.checkAuth();
    console.log('Donor Dashboard session:', session);
    
    if (!session) {
        console.log('‚ùå No session found, redirecting to login');
        alert('Please log in to access the donor dashboard');
        window.location.href = 'LoginSignUp.html';
        return;
    }
    
    // Check if user has donor profile
    const { data: donorProfile, error } = await window.authHelper.supabase
        .from('donor_profiles')
        .select('id, first_name')
        .eq('id', session.user.id)
        .single();

    if (error || !donorProfile) {
        console.log('‚ùå No donor profile found, redirecting');
        alert('Donor profile not found. Please complete donor registration.');
        window.location.href = 'CreateProfile.html';
        return;
    }

    console.log('‚úÖ Donor authentication successful:', donorProfile.first_name);
    
    // === MAIN DONOR DASHBOARD CODE ===
    let currentUser = session.user;
    let fileStore = new DataTransfer();
    let currentRequestId = null;

    await loadUserData();
    initializeEventListeners();

    async function loadUserData() {
        const { data: profile } = await window.authHelper.supabase
            .from('donor_profiles')
            .select('*')
            .eq('id', currentUser.id)
            .single();

        if (profile) {
            document.getElementById('user-name').textContent = profile.first_name;
            await updateDashboardStats();
            await loadProfileData();
        }
    }

    async function updateDashboardStats() {
        // Total donations
        const { data: donations } = await window.authHelper.supabase
            .from('donations')
            .select('id, quantity_required, status')
            .eq('donor_id', currentUser.id);

        if (donations) {
            document.getElementById('total-donations').textContent = donations.length;
            
            const acceptedDonations = donations.filter(d => d.status === 'accepted' || d.status === 'delivered');
            const ngoCount = new Set(acceptedDonations.map(d => d.id)).size;
            const livesTouched = acceptedDonations.reduce((sum, d) => sum + parseInt(d.quantity_required || 0, 10), 0);
            
            document.getElementById('ngo-count').textContent = ngoCount;
            document.getElementById('lives-touched').textContent = livesTouched;
        }

        // Pending requests
        const { data: requests } = await window.authHelper.supabase
            .from('donation_requests')
            .select('id')
            .eq('donor_id', currentUser.id)
            .eq('status', 'pending');

        document.getElementById('pending-requests').textContent = requests?.length || 0;

        // Active deliveries
        const { data: deliveries } = await window.authHelper.supabase
            .from('delivery_tracking')
            .select('id')
            .eq('donor_id', currentUser.id)
            .in('status', ['pickup_pending', 'picked_up', 'in_transit']);

        document.getElementById('active-deliveries').textContent = deliveries?.length || 0;
    }

    function initializeImageUpload() {
        const fileInput = document.getElementById('item-images');
        const previewContainer = document.getElementById('image-preview-container');

        fileInput.addEventListener('change', (event) => {
            for (const file of event.target.files) fileStore.items.add(file);
            fileInput.files = fileStore.files;
            renderPreviews();
        });

        function renderPreviews() {
            previewContainer.innerHTML = "";
            for (let i = 0; i < fileStore.files.length; i++) {
                const file = fileStore.files[i];
                if (!file.type.startsWith("image/")) continue;
                const reader = new FileReader();
                reader.onload = (e) => {
                    const wrapper = document.createElement("div");
                    wrapper.className = "relative w-24 h-24";
                    const img = document.createElement("img");
                    img.src = e.target.result;
                    img.className = "w-full h-full object-cover rounded-lg border-2 border-gray-200";
                    wrapper.appendChild(img);
                    const removeBtn = document.createElement("button");
                    removeBtn.type = "button";
                    removeBtn.innerHTML = "&times;";
                    removeBtn.className = "absolute top-0 right-0 -mt-2 -mr-2 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center text-xs font-bold hover:bg-red-700 transition-transform transform hover:scale-110";
                    removeBtn.onclick = () => removeFile(i);
                    wrapper.appendChild(removeBtn);
                    previewContainer.appendChild(wrapper);
                };
                reader.readAsDataURL(file);
            }
        }

        function removeFile(index) {
            const newFileStore = new DataTransfer();
            for (let i = 0; i < fileStore.files.length; i++) {
                if (i !== index) newFileStore.items.add(fileStore.files[i]);
            }
            fileStore = newFileStore;
            fileInput.files = fileStore.files;
            renderPreviews();
        }
    }

    function initializeEventListeners() {
        initializeImageUpload();

        // Navigation
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const viewName = e.currentTarget.id.split('-')[1];
                switchView(viewName);
            });
        });

        // Logout
        document.getElementById('nav-logout').addEventListener('click', async (e) => {
            e.preventDefault();
            await window.authHelper.logoutUser();
        });

        // Donation form
        document.getElementById('donate-item-btn').addEventListener('click', () => {
            if (validateDonationForm()) {
                document.getElementById('confirmation-modal').classList.remove('hidden');
            }
        });

        // Modal handlers
        document.getElementById('confirm-donate-btn').addEventListener('click', submitDonation);
        document.getElementById('cancel-donate-btn').addEventListener('click', () => {
            document.getElementById('confirmation-modal').classList.add('hidden');
        });
        document.getElementById('success-ok-btn').addEventListener('click', () => {
            document.getElementById('success-modal').classList.add('hidden');
            document.getElementById('donation-form').reset();
            document.getElementById('image-preview-container').innerHTML = '';
            fileStore = new DataTransfer();
            // Reset tag selection
            document.querySelectorAll('.tag-btn').forEach(btn => {
                btn.classList.remove('bg-pink-500', 'text-black');
            });
            document.getElementById('selected-tag').value = '';
        });

        // Request decision handlers
        document.getElementById('accept-request-btn').addEventListener('click', () => handleRequestDecision('accepted'));
        document.getElementById('reject-request-btn').addEventListener('click', () => handleRequestDecision('rejected'));
        document.getElementById('cancel-request-btn').addEventListener('click', () => {
            document.getElementById('request-decision-modal').classList.add('hidden');
        });

        // Tag selection
        // document.querySelectorAll('.tag-btn').forEach(btn => {
        //     btn.addEventListener('click', () => {
        //         document.querySelectorAll('.tag-btn').forEach(b => b.classList.remove('bg-pink-500', 'text-white', 'text-black'));
        //         btn.classList.add('bg-pink-500', 'text-black');
        //         document.getElementById('selected-tag').value = btn.textContent;
        //     });
        // });
        let tagButtons = document.querySelectorAll(".tag-btn");
        let selectedTagInput = document.getElementById("selected-tag");
        let selectedTagBtn = null;
        tagButtons.forEach((btn) => {
          btn.addEventListener("click", () => {
            if (selectedTagBtn === btn) {
              btn.classList.remove("bg-pink-500", "text-white");
              btn.classList.add("bg-white", "text-pink-600");
              selectedTagBtn = null;
              selectedTagInput.value = "";
            } else {
              tagButtons.forEach((b) => {
                b.classList.remove("bg-pink-500", "text-white");
                b.classList.add("bg-white", "text-pink-600");
              });
              btn.classList.add("bg-pink-500", "text-white");
              btn.classList.remove("bg-white", "text-pink-600");
              selectedTagBtn = btn;
              selectedTagInput.value = btn.textContent.trim();
            }
          });
        });
        // Profile form
        document.getElementById('profile-form').addEventListener('submit', updateProfile);
    }

    function validateDonationForm() {
        const form = document.getElementById('donation-form');
        if (!form.checkValidity()) {
            form.reportValidity();
            return false;
        }
        if (!document.getElementById('selected-tag').value) {
            alert('Please select a tag.');
            return false;
        }
        return true;
    }

   async function submitDonation() {
    const itemName = document.getElementById('item-name').value;
    const quantity = document.getElementById('quantity-required').value;
    const description = document.getElementById('item-description').value;
    const tag = document.getElementById('selected-tag').value;

    try {
        // Get donor's location from profile
        const { data: donorProfile } = await window.authHelper.supabase
            .from('donor_profiles')
            .select('city, state, pin_code, address')
            .eq('id', currentUser.id)
            .single();

        if (!donorProfile) {
            alert('Please complete your profile first.');
            return;
        }

        // Upload images - FIXED VERSION
        let imageUrls = [];
        console.log('üì§ Starting image upload...', fileStore.files.length, 'files');
        
        if (fileStore.files.length > 0) {
            for (let i = 0; i < fileStore.files.length; i++) {
                const file = fileStore.files[i];
                console.log(`üñºÔ∏è Uploading file ${i + 1}:`, file.name, file.size);
                
                if (file.size > 5 * 1024 * 1024) {
                    alert(`File ${file.name} is too large. Maximum size is 5MB.`);
                    continue;
                }
                
                const fileExt = file.name.split('.').pop();
                const fileName = `${currentUser.id}_${Date.now()}_${i}.${fileExt}`;
                const filePath = `donation-images/${fileName}`;

                console.log('üìÅ Uploading to path:', filePath);
                
                const { data: uploadData, error: uploadError } = await window.authHelper.supabase.storage
                    .from('donation-images')
                    .upload(filePath, file, {
                        cacheControl: '3600',
                        upsert: false
                    });

                if (uploadError) {
                    console.error('‚ùå Upload failed:', uploadError);
                    alert(`Failed to upload ${file.name}: ${uploadError.message}`);
                    continue;
                }

                console.log('‚úÖ Upload successful:', uploadData);

                // Get public URL
                const { data: { publicUrl } } = window.authHelper.supabase.storage
                    .from('donation-images')
                    .getPublicUrl(filePath);

                console.log('üîó Public URL:', publicUrl);
                imageUrls.push(publicUrl);
            }
        }

        console.log('üé® Final image URLs:', imageUrls);

        // Create donation
        const { data: donationData, error } = await window.authHelper.supabase
            .from('donations')
            .insert([{
                donor_id: currentUser.id,
                item_name: itemName,
                quantity_required: quantity,
                description: description,
                item_tag: tag,
                item_image_url: imageUrls.length > 0 ? imageUrls.join(',') : null,
                donor_city: donorProfile.city,
                donor_state: donorProfile.state,
                donor_pincode: donorProfile.pin_code,
                donor_address: donorProfile.address,
                status: 'available'
            }])
            .select(); // Add .select() to get the inserted data

        if (error) {
            console.error('‚ùå Donation creation failed:', error);
            throw error;
        }

        console.log('‚úÖ Donation created:', donationData);

        document.getElementById('confirmation-modal').classList.add('hidden');
        document.getElementById('success-modal').classList.remove('hidden');
        await updateDashboardStats();

    } catch (error) {
        console.error('üí• Donation submission failed:', error);
        alert('Failed to submit donation: ' + error.message);
    }
}

    function switchView(viewName) {
    // Hide all views
    document.querySelectorAll('main > div').forEach(view => view.classList.add('hidden'));
    
    // Remove active styling from all nav links
    document.querySelectorAll('.nav-link').forEach(link => {
        link.classList.remove('bg-pink-500', 'text-white', 'text-black');
        link.classList.add('text-gray-600', 'hover:bg-pink-100');
    });
    
    // Show the selected view
    document.getElementById(`view-${viewName}`).classList.remove('hidden');
    
    // Add active styling to the clicked nav link
    const activeNav = document.getElementById(`nav-${viewName}`);
    activeNav.classList.remove('text-gray-600', 'hover:bg-pink-100');
    activeNav.classList.add('bg-pink-500', 'text-white');

    // Load data for the view
    if (viewName === 'donations') {
        loadDonations();
    } else if (viewName === 'requests') {
        loadDonationRequests();
    } else if (viewName === 'tracking') {
        loadDeliveryTracking();
    } else if (viewName === 'profile') {
        loadProfileData();
    }
}

    async function loadDonations() {
        const { data: donations } = await window.authHelper.supabase
            .from('donations')
            .select('*')
            .eq('donor_id', currentUser.id)
            .order('created_at', { ascending: false });

        const container = document.getElementById('donations-container');
        container.innerHTML = '';

        if (!donations || donations.length === 0) {
            container.innerHTML = '<p class="col-span-full text-center text-gray-500">You haven\'t made any donations yet.</p>';
            return;
        }

        donations.forEach(donation => {
            const card = document.createElement('div');
            card.className = 'bg-white rounded-xl shadow-md p-6';
            const imageUrl = donation.item_image_url ? donation.item_image_url.split(',')[0] : 'https://placehold.co/400x300/FFC0CB/333333?text=No+Image';
            
            card.innerHTML = `
                <img src="${imageUrl}" class="w-full h-48 object-cover rounded-lg mb-4">
                <h3 class="text-xl font-semibold">${donation.item_name}</h3>
                <p class="text-gray-600">Quantity: ${donation.quantity_required}</p>
                <p class="text-gray-600">Tag: ${donation.item_tag}</p>
                <p class="text-gray-600">Status: <span class="font-semibold ${getStatusColor(donation.status)}">${donation.status}</span></p>
                <p class="text-gray-500 text-sm mt-2">${new Date(donation.created_at).toLocaleDateString()}</p>
            `;
            container.appendChild(card);
        });
    }

    async function loadDonationRequests() {
        const { data: requests } = await window.authHelper.supabase
            .from('donation_requests')
            .select(`
                *,
                donations (*),
                ngo_profiles (ngo_name, contact_phone, contact_email, city, state)
            `)
            .eq('donor_id', currentUser.id)
            .order('created_at', { ascending: false });

        const container = document.getElementById('requests-container');
        container.innerHTML = '';

        if (!requests || requests.length === 0) {
            container.innerHTML = '<p id="no-requests-message" class="text-center text-gray-500">No pending requests at the moment.</p>';
            return;
        }

        requests.forEach(request => {
            const card = document.createElement('div');
            card.className = 'bg-white rounded-xl shadow-lg p-6';
            const donation = request.donations;
            const ngo = request.ngo_profiles;
            
            card.innerHTML = `
                <div class="flex justify-between items-start mb-4">
                    <h3 class="text-xl font-semibold">${donation.item_name}</h3>
                    <span class="px-3 py-1 rounded-full text-sm font-medium ${getRequestStatusColor(request.status)}">
                        ${request.status}
                    </span>
                </div>
                <div class="space-y-2">
                    <p><strong>NGO:</strong> ${ngo.ngo_name}</p>
                    <p><strong>Location:</strong> ${ngo.city}, ${ngo.state}</p>
                    <p><strong>Contact:</strong> ${ngo.contact_phone} | ${ngo.contact_email}</p>
                    ${request.request_message ? `<p><strong>Message:</strong> ${request.request_message}</p>` : ''}
                    <p><strong>Requested on:</strong> ${new Date(request.created_at).toLocaleDateString()}</p>
                </div>
                ${request.status === 'pending' ? `
                    <div class="mt-4 flex gap-2">
                        <button onclick="showRequestDecision('${request.id}')" class="bg-pink-500 text-white px-4 py-2 rounded-lg hover:bg-pink-700 transition-colors">
                            Review Request
                        </button>
                    </div>
                ` : ''}
            `;
            container.appendChild(card);
        });
    }

    async function loadDeliveryTracking() {
        const { data: tracking } = await window.authHelper.supabase
            .from('delivery_tracking')
            .select(`
                *,
                donations (item_name, item_image_url),
                ngo_profiles (ngo_name, address)
            `)
            .eq('donor_id', currentUser.id)
            .order('created_at', { ascending: false });

        const container = document.getElementById('tracking-container');
        container.innerHTML = '';

        if (!tracking || tracking.length === 0) {
            container.innerHTML = '<p id="no-tracking-message" class="text-center text-gray-500">No active deliveries to track.</p>';
            return;
        }

        tracking.forEach(track => {
            const card = document.createElement('div');
            card.className = 'bg-white rounded-xl shadow-lg p-6';
            const donation = track.donations;
            const ngo = track.ngo_profiles;
            const imageUrl = donation.item_image_url ? donation.item_image_url.split(',')[0] : 'https://placehold.co/400x300/FFC0CB/333333?text=No+Image';
            
            card.innerHTML = `
                <div class="flex items-start gap-4">
                    <img src="${imageUrl}" class="w-24 h-24 object-cover rounded-lg">
                    <div class="flex-1">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="text-xl font-semibold">${donation.item_name}</h3>
                            <span class="px-3 py-1 rounded-full text-sm font-medium ${getTrackingStatusColor(track.status)}">
                                ${track.status.replace('_', ' ').toUpperCase()}
                            </span>
                        </div>
                        <div class="space-y-2 text-sm">
                            <p><strong>Tracking ID:</strong> ${track.tracking_id}</p>
                            <p><strong>NGO:</strong> ${ngo.ngo_name}</p>
                            <p><strong>Delivery Address:</strong> ${ngo.address}</p>
                            ${track.actual_pickup_date ? `<p><strong>Picked up:</strong> ${new Date(track.actual_pickup_date).toLocaleDateString()}</p>` : ''}
                            ${track.actual_delivery_date ? `<p><strong>Delivered:</strong> ${new Date(track.actual_delivery_date).toLocaleDateString()}</p>` : ''}
                        </div>
                    </div>
                </div>
            `;
            container.appendChild(card);
        });
    }

    function getStatusColor(status) {
        const colors = {
            'available': 'text-green-600',
            'requested': 'text-yellow-600',
            'accepted': 'text-blue-600',
            'in_transit': 'text-purple-600',
            'delivered': 'text-gray-600'
        };
        return colors[status] || 'text-gray-600';
    }

    function getRequestStatusColor(status) {
        const colors = {
            'pending': 'bg-yellow-100 text-yellow-800',
            'accepted': 'bg-green-100 text-green-800',
            'rejected': 'bg-red-100 text-red-800',
            'cancelled': 'bg-gray-100 text-gray-800'
        };
        return colors[status] || 'bg-gray-100 text-gray-800';
    }

    function getTrackingStatusColor(status) {
        const colors = {
            'pickup_pending': 'bg-yellow-100 text-yellow-800',
            'picked_up': 'bg-blue-100 text-blue-800',
            'in_transit': 'bg-purple-100 text-purple-800',
            'delivered': 'bg-green-100 text-green-800'
        };
        return colors[status] || 'bg-gray-100 text-gray-800';
    }

    async function loadProfileData() {
        const { data: profile } = await window.authHelper.supabase
            .from('donor_profiles')
            .select('*')
            .eq('id', currentUser.id)
            .single();

        if (profile) {
            document.getElementById('profile-first-name').value = profile.first_name;
            document.getElementById('profile-last-name').value = profile.last_name;
            document.getElementById('profile-email').value = profile.email;
            document.getElementById('profile-phone-number').value = profile.phone_number || '';
            document.getElementById('profile-age').value = profile.age || '';
            document.getElementById('profile-city').value = profile.city || '';
            document.getElementById('profile-state').value = profile.state || '';
            document.getElementById('profile-pin-code').value = profile.pin_code || '';
            document.getElementById('profile-address').value = profile.address || '';
        }
    }

    async function updateProfile(e) {
        e.preventDefault();
        const updates = {
            first_name: document.getElementById('profile-first-name').value,
            last_name: document.getElementById('profile-last-name').value,
            phone_number: document.getElementById('profile-phone-number').value,
            age: document.getElementById('profile-age').value,
            city: document.getElementById('profile-city').value,
            state: document.getElementById('profile-state').value,
            pin_code: document.getElementById('profile-pin-code').value,
            address: document.getElementById('profile-address').value,
            updated_at: new Date().toISOString()
        };

        const { error } = await window.authHelper.supabase
            .from('donor_profiles')
            .update(updates)
            .eq('id', currentUser.id);

        if (error) {
            alert('Failed to update profile: ' + error.message);
        } else {
            alert('Profile updated successfully!');
            document.getElementById('user-name').textContent = updates.first_name;
        }
    }

    // Global function for request decision
    window.showRequestDecision = function(requestId) {
        currentRequestId = requestId;
        document.getElementById('request-decision-modal').classList.remove('hidden');
    };

    async function handleRequestDecision(decision) {
        if (!currentRequestId) return;

        try {
            // Update request status
            const { error: requestError } = await window.authHelper.supabase
                .from('donation_requests')
                .update({ status: decision, updated_at: new Date().toISOString() })
                .eq('id', currentRequestId);

            if (requestError) throw requestError;

            if (decision === 'accepted') {
                // Get request details
                const { data: request } = await window.authHelper.supabase
                    .from('donation_requests')
                    .select('donation_id, ngo_id, donor_id')
                    .eq('id', currentRequestId)
                    .single();

                if (request) {
                    // Update donation status
                    const { error: donationError } = await window.authHelper.supabase
                        .from('donations')
                        .update({ status: 'accepted', updated_at: new Date().toISOString() })
                        .eq('id', request.donation_id);

                    if (donationError) throw donationError;

                    // Get donor address for pickup
                    const { data: donor } = await window.authHelper.supabase
                        .from('donor_profiles')
                        .select('city, state, pin_code, address')
                        .eq('id', request.donor_id)
                        .single();

                    const { data: ngo } = await window.authHelper.supabase
                        .from('ngo_profiles')
                        .select('address')
                        .eq('id', request.ngo_id)
                        .single();

                    // Create delivery tracking
                    const { error: trackingError } = await window.authHelper.supabase
                        .from('delivery_tracking')
                        .insert([{
                            donation_id: request.donation_id,
                            ngo_id: request.ngo_id,
                            donor_id: request.donor_id,
                            pickup_address: donor.address || `${donor.city}, ${donor.state} - ${donor.pin_code}`,
                            delivery_address: ngo.address,
                            pickup_scheduled_date: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000).toISOString(), // 2 days from now
                            tracking_id: 'TRK' + Date.now().toString().slice(-8)
                        }]);

                    if (trackingError) throw trackingError;
                }
            }

            document.getElementById('request-decision-modal').classList.add('hidden');
            alert(`Request ${decision} successfully!`);
            await updateDashboardStats();
            await loadDonationRequests();

        } catch (error) {
            alert('Failed to process request: ' + error.message);
        }
    }
});
// Notification UI functionality
function setupNotificationUI() {
    const notificationsBtn = document.getElementById('notifications-btn');
    const notificationsDropdown = document.getElementById('notifications-dropdown');
    const notificationsList = document.getElementById('notifications-list');
    const notificationCount = document.getElementById('notification-count');
    const markAllReadBtn = document.getElementById('mark-all-read');

    // Toggle dropdown
    if (notificationsBtn && notificationsDropdown) {
        notificationsBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            notificationsDropdown.classList.toggle('hidden');
            loadNotificationsIntoUI();
        });
    }

    // Close dropdown when clicking outside
    document.addEventListener('click', (e) => {
        if (notificationsDropdown && !notificationsDropdown.contains(e.target) && 
            notificationsBtn && !notificationsBtn.contains(e.target)) {
            notificationsDropdown.classList.add('hidden');
        }
    });

    // Mark all as read
    if (markAllReadBtn) {
        markAllReadBtn.addEventListener('click', async () => {
            await markAllNotificationsAsRead();
            loadNotificationsIntoUI();
        });
    }

    // Load notifications every 30 seconds
    setInterval(loadNotificationsIntoUI, 30000);
}

async function loadNotificationsIntoUI() {
    try {
        const { data: notifications, error } = await window.authHelper.supabase
            .from('notifications')
            .select('*')
            .eq('user_id', window.notificationSystem.currentUser.id)
            .order('created_at', { ascending: false })
            .limit(10);

        if (error) throw error;

        const notificationsList = document.getElementById('notifications-list');
        const notificationCount = document.getElementById('notification-count');

        if (!notificationsList) return;

        // Update notification count
        const unreadCount = notifications.filter(n => !n.is_read).length;
        if (notificationCount) {
            if (unreadCount > 0) {
                notificationCount.textContent = unreadCount > 99 ? '99+' : unreadCount;
                notificationCount.classList.remove('hidden');
            } else {
                notificationCount.classList.add('hidden');
            }
        }

        // Update notifications list
        if (notifications.length === 0) {
            notificationsList.innerHTML = '<p class="text-gray-500 text-center p-4">No notifications</p>';
            return;
        }

        notificationsList.innerHTML = notifications.map(notification => `
            <div class="notification-item p-3 border-b border-gray-100 hover:bg-gray-50 cursor-pointer ${!notification.is_read ? 'bg-blue-50' : ''}" 
                 data-notification-id="${notification.id}">
                <div class="flex justify-between items-start">
                    <div class="flex-1">
                        <p class="font-medium text-sm ${!notification.is_read ? 'text-blue-800' : 'text-gray-800'}">${notification.title}</p>
                        <p class="text-xs text-gray-600 mt-1">${notification.message}</p>
                        <p class="text-xs text-gray-400 mt-1">${new Date(notification.created_at).toLocaleString()}</p>
                    </div>
                    ${!notification.is_read ? '<div class="w-2 h-2 bg-blue-500 rounded-full ml-2 mt-1"></div>' : ''}
                </div>
            </div>
        `).join('');

        // Add click events to notification items
        document.querySelectorAll('.notification-item').forEach(item => {
            item.addEventListener('click', async () => {
                const notificationId = item.dataset.notificationId;
                await window.notificationSystem.markAsRead(notificationId);
                item.classList.remove('bg-blue-50');
                item.querySelector('.w-2')?.remove();
                loadNotificationsIntoUI(); // Refresh the list
            });
        });

    } catch (error) {
        console.error('üîî Error loading notifications UI:', error);
    }
}

async function markAllNotificationsAsRead() {
    try {
        const { error } = await window.authHelper.supabase
            .from('notifications')
            .update({ 
                is_read: true,
                read_at: new Date().toISOString()
            })
            .eq('user_id', window.notificationSystem.currentUser.id)
            .eq('is_read', false);

        if (error) throw error;

        console.log('üîî Marked all notifications as read');
        
        // Update UI
        const notificationCount = document.getElementById('notification-count');
        if (notificationCount) {
            notificationCount.classList.add('hidden');
        }

    } catch (error) {
        console.error('üîî Error marking all as read:', error);
    }
}

// Initialize notification UI when dashboard loads
document.addEventListener('DOMContentLoaded', () => {
    setTimeout(() => {
        if (window.notificationSystem && window.notificationSystem.currentUser) {
            setupNotificationUI();
            loadNotificationsIntoUI();
        }
    }, 3000);
});
</script>
  </body>
</html>